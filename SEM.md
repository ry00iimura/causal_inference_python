# SEM Structual Equation Modeling(構造方程式モデリング)

## これは何？
- 因子分析の発展版
- 因子分析では、変数から抽出した共通因子から、その変数に共通する本質的な要因を探りました。
- SEMでは、変数A1,変数A2に共通する共通因子A'、変数B1,変数B2に共通する共通因子B'と仮定したとき、
共通因子A'と共通因子B'にも関係性を見出したり、変数B1と共通因子A'なの、あらゆる要素に関係性を見出すことで、共通因子A'の裏に潜む共通因子B'のように、より本質をついた要因を探ることができます。

## 言葉の確認
### 観測変数
- データにあたる列
- 観測されたデータ

### 潜在変数
- 因子分析内の共通因子のことをSEMでは潜在変数と呼ぶ
- 観測変数同士の共通した性質

### 誤差変数
- SEMでモデリングしたときにモデリングしきれなかった変数をまとめたもの

### パス係数
- 因子分解の因子負荷量にあたる。観測変数と潜在変数を結ぶ→にかける重みづけの値のこと

### 総合効果
- SEMではあらゆる要素が結び合っている。その時例えば、潜在変数Aに影響を与える効果がどれくらいあるのかを示すのが総合効果
- 総合効果は、直接潜在変数Aに影響を与える効果量＝直接効果と、別の変数（介在変数）を経由して影響を与える効果量＝間接効果の和で示す。

## で、SEM分析はずばり何をトライ＆エラーしてくの？
- いい感じのパス図を工夫して作ってくこと

## モデルの評価
- 以下の指標でモデルを評価します。

### χ二乗統計量
- 「モデルが正しいかどうか」を評価するための指標
- 実際はP値で評価する。帰無仮説が「モデルが正しい」なので、P値が0.05より大きいことが求められます。
- ただし、サンプルサイズが大きくなると帰無仮説は棄却されることが知られています。そのため、大きいサンプルサイズでX二乗統計量は意味を成しません。

### RMSEA
- モデルが好ましいか、好ましくないかを評価するための指標です。
- 0.05 以下は良好、0.1以上は好ましくありません。
- χ二乗に基づく値ですが、標本サイズの自由度で補正されているので、標本サイズによらず信頼できる値です。

### GFI
- モデルの良さを示します。
- 0.9以上がいいモデルとなります。
- 重回帰モデルの決定係数に相当する指標です。
- 観測変数の数が増えると値が大きくなる傾向が知られていますので、通常は補正した値AGFIを使用します。

### CFI
- 推定したモデルが飽和モデルに近いのか独立モデルに近いのかを評価します。
- 飽和モデルとはすべての変数が関連付けられていて、パス係数の有意性が判断できないモデルです。
- 独立モデルは、パスが一切ないモデルです
- 0.9以上がいいモデルとされます。

### AIC or BIC
- 複数のSEMモデルを作成したとき、どのモデルが最もいいのかを測る指標です。
- 相対指標なので、その値そのものに意味はなく、大小比較のみに使います。
- 値の小さいほうがいいモデル（適合度が高いモデルとなります。）


### で、SEMのトライ＆エラーは何を見て改善していくの？
- 各矢印の大きさ。
- 0.3より小さいならパス図を書き換えようみたいな感じ
- 最初にパス図を描くとき（どの観測変数が何の因子をもってそうだみたいなところ）は相関係数を見て決める。
- 国語と英語は言語力、数学と物理は論理数理力など

### 結局SEM自体は何を推定しているのか？
- 各要素の→の重み（大きさ）をいい感じに推定している。

### どんな感じでSEMは重みを推定していくのか？
- 以下を理解しておくことで、論理的な理解を今後していくうえで役に立つ
- 自分から→は出すけど、自分には→がささっていない要素は、因子同士が相関している場合を除き正規分布に従っている。
- α、β、ρがきまると観測変数の相関が決まる。
- もともとの観測変数同士の相関を一番よく再現できるα、β、ρを見つけに行く。

## 補足
- これまでpythonではSEMのライブラリーがありませんでしたが、ついに2019年にSemopyというライブラリが登場！
- SyntaxはRライク
- https://pypi.org/project/semopy/

## 引用
- https://qiita.com/deaikei/items/9e5de7f97c5e0a061c5d
- https://semopy.readthedocs.io/en/latest/source./semopy.html#module-semopy.visualization